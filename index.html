<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="./js/utils.js"></script>
  <script src="./js/getProducts.js"></script>
  <script src="./js/header.js"></script>
  <script src="./js/cart.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style type="text/tailwindcss">
    @theme {
        --color-clifford: #da373d;
      }
    </style>
  <style>
    .hero-video {
      object-position: center 60%; /* Show more top and bottom */
      /* Optimize video quality for low-res videos */
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      image-rendering: pixelated; /* Better for low-res upscaling */
      /* Ensure high quality scaling */
      transform: translateZ(0) scale(0.95); /* Light zoom out to show more */
      backface-visibility: hidden;
      perspective: 1000px;
      /* Force better interpolation */
      filter: contrast(1.1) brightness(1.05);
    }
    
    /* Better video container for quality */
    .video-container {
      transform: translateZ(0);
      will-change: transform;
      /* No padding needed now */
    }
    
    /* Alternative: Smaller video size to avoid blurriness */
    .hero-video-small {
      width: 360px;
      height: 430px;
      object-fit: cover;
      margin: 0 auto;
      display: block;
    }
  </style>
</head>

<body class="bg-white min-h-screen flex flex-col">
  <!-- Header -->
  <div id="header-placeholder"></div>

  <!-- Hero Video Section -->
  <section class="relative w-full h-[600px] overflow-hidden bg-gray-50 px-8 py-6">
    <div class="video-container w-full h-full max-w-5xl mx-auto rounded-xl overflow-hidden shadow-xl">
      <video 
        class="hero-video w-full h-full object-cover" 
        autoplay 
        muted 
        loop 
        playsinline
        preload="auto"
        onloadstart="console.log('Video loading started')"
        oncanplay="console.log('Video can play')"
        onerror="console.log('Video error:', event); this.style.display='none'; document.getElementById('video-fallback').style.display='flex';"
        onloadeddata="console.log('Video loaded successfully'); this.style.display='block';"
      >
        <!-- No video sources currently -->
        <!-- Fallback message -->
        <div id="video-fallback" class="w-full h-full flex items-center justify-center bg-gray-200" style="display: none;">
          <p class="text-gray-500">Video not supported</p>
        </div>
      </video>
    </div>
  </section>

  <!-- Products Grid -->
  <main class="flex-1 container mx-auto px-4 py-8 bg-white">
    <h3 class="text-2xl font-bold text-gray-800 mb-6">Featured Products</h3>
    <div id="products-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 bg-white">
      <!-- Products will be injected here -->
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white mt-8">
    <div class="container mx-auto px-4 py-6 text-center text-gray-500">
      &copy; 2025 Mavi Webshop. All rights reserved.
    </div>
  </footer>

  <!-- Cart Drawer -->
  <div id="cart-backdrop" class="fixed inset-0 z-40 hidden" style="background: rgba(255,255,255,0.4);"></div>
  <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full max-w-xl bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 flex flex-col" style="width:40vw; min-width:320px;">
    <div class="flex items-center justify-between px-6 py-4 border-b">
      <span class="text-xl font-semibold" style="font-family: 'Inter', sans-serif;">Varukorg</span>
      <button id="cart-close" class="text-2xl text-gray-400 hover:text-black">&times;</button>
    </div>
    <!-- Cart items go here -->
    <div id="cart-items" class="flex-1 overflow-y-auto px-6 py-4"></div>
    <div class="border-t px-6 py-4">
      <div class="flex justify-between items-center mb-4">
        <span class="font-semibold">Totalt:</span>
        <span id="cart-total" class="font-semibold">0 kr</span>
      </div>
      <button class="w-full bg-black text-white py-3 rounded-none font-semibold text-base hover:bg-gray-900 transition">Till kassan</button>
    </div>
  </div>

  <script>
    // Video quality optimization
    document.addEventListener('DOMContentLoaded', function() {
      const video = document.querySelector('.hero-video');
      
      if (video) {
        // Force high quality rendering
        video.style.imageRendering = 'high-quality';
        video.style.imageRendering = '-webkit-optimize-contrast';
        
        // Ensure video plays at full quality
        video.addEventListener('loadedmetadata', function() {
          console.log('Video dimensions:', video.videoWidth, 'x', video.videoHeight);
          
          // Check if this is a high-resolution video
          if (video.videoWidth >= 720 && video.videoHeight >= 720) {
            console.log('High resolution detected - using cropped view with more content');
            
            // Keep the cropped look but show more content
            video.style.width = '100%';
            video.style.height = '100%';
            video.style.objectFit = 'cover';
            video.style.objectPosition = 'center 60%'; // Show more top/bottom
            video.style.transform = 'translateZ(0) scale(0.95)'; // Slight zoom out
            
            // Reset container to normal
            video.parentElement.style.display = 'block';
            video.parentElement.style.alignItems = 'unset';
            video.parentElement.style.justifyContent = 'unset';
            video.parentElement.style.background = 'transparent';
            video.parentElement.style.padding = '0';
            
          } else if (video.videoWidth <= 480 || video.videoHeight <= 480) {
            console.log('Low resolution detected - adjusting display');
            
            // Option 1: Show at native size to avoid blurriness
            video.style.width = video.videoWidth + 'px';
            video.style.height = video.videoHeight + 'px';
            video.style.maxWidth = '100%';
            video.style.objectFit = 'contain';
            
            // Center the video
            video.parentElement.style.display = 'flex';
            video.parentElement.style.alignItems = 'center';
            video.parentElement.style.justifyContent = 'center';
            video.parentElement.style.background = '#f0f0f0';
            
            // Add message about video quality
            const qualityNote = document.createElement('div');
            qualityNote.style.cssText = 'position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.9); padding: 10px 20px; border-radius: 20px; font-size: 14px; color: #666; z-index: 10;';
            qualityNote.textContent = 'Original video size: ' + video.videoWidth + 'x' + video.videoHeight;
            video.parentElement.parentElement.appendChild(qualityNote);
            
            setTimeout(() => qualityNote.remove(), 4000);
          }
          
          // Show video info temporarily for debugging
          const infoDiv = document.createElement('div');
          infoDiv.style.cssText = 'position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 1000; font-family: monospace;';
          infoDiv.innerHTML = `
            Video Info:<br>
            Resolution: ${video.videoWidth} x ${video.videoHeight}<br>
            File: ${video.currentSrc.split('/').pop().substring(0, 20)}...<br>
            Duration: ${video.duration.toFixed(1)}s<br>
            <span style="color: ${video.videoWidth < 720 ? '#ff6b6b' : '#51cf66'}">
              Quality: ${video.videoWidth >= 1280 ? 'HIGH' : video.videoWidth >= 720 ? 'GOOD' : 'LOW'}
            </span>
          `;
          document.body.appendChild(infoDiv);
          
          // Remove info after 8 seconds
          setTimeout(() => infoDiv.remove(), 8000);
          
          // If video quality seems low, try to reload
          if (video.videoWidth < 720) {
            console.log('Low quality video detected, checking alternatives...');
          }
        });
        
        // Handle video loading errors and try alternative
        video.addEventListener('error', function(e) {
          console.log('Video error occurred:', e);
          console.log('Current source:', video.currentSrc);
          
          // Force try the MOV file directly if MP4 fails
          if (!video.currentSrc.includes('.mov')) {
            console.log('MP4 failed, trying MOV directly...');
            video.src = './img/front2.mov';
            video.load();
          } else {
            console.log('All video sources failed, showing fallback');
            video.style.display = 'none';
            document.getElementById('video-fallback').style.display = 'flex';
          }
        });
        
        // Also handle if no video sources work
        video.addEventListener('loadstart', function() {
          console.log('Video load started, source:', video.currentSrc);
        });
        
        // Timeout fallback if video doesn't load within 5 seconds
        setTimeout(function() {
          if (video.readyState === 0) {
            console.log('Video timeout - forcing MOV fallback');
            video.src = './img/front2.mov';
            video.load();
          }
        }, 5000);
        
        // Optimize video playback
        video.addEventListener('canplaythrough', function() {
          video.style.opacity = '1';
          console.log('Video ready for high quality playback');
        });
      }
    });
  </script>
</body>

</html>